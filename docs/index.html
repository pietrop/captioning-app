<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Captions Maker</title>

  <!-- Latest compiled and minified CSS -->
  <!-- TODO: move to local folder -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/paper/bootstrap.min.css" >
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://www.youtube.com/iframe_api"></script>
 
  </head>
  <body>



<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-2">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Captions Maker</a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
    
      <form class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <input type="text" id="videoYoutubeUrlInput" class="form-control" placeholder="Add Youtube URL" value="https://youtu.be/k_HZczxGfnY" >
          <!--  https://youtu.be/pWZAF3j_jA4  https://youtu.be/CrpkZkwTvu0 -->
        </div>
        <button type="submit" id="loadYoutubeUrlBtn" class="btn btn-primary">Load</button>

      </form>
      <ul class="nav navbar-nav">
        <form class="navbar-form navbar-left" role="search">
          <a  id="selectFileBtn" class="btn btn-primary">Select file</a>
        </form>
            <!--  <li><a href="#">Link</a></li> -->
      </ul>
      <ul class="nav navbar-nav navbar-right">
       <!-- li -->
      </ul>
    </div>
  </div>
</nav>

<div class="container" >
  <div class="row">
    <div class="col-xs-12 col-sm-3  col-md-3  col-lg-3">
      <!-- <label for="select" class="control-label">Video preview</label> -->
      <!-- <a  id="selectFileBtn" class="btn btn-primary btn-xs ">Select file</a> -->
         <!-- <br><br> -->
      <div id="videoPreview" class="embed-responsive embed-responsive-16by9">
      </div>

<br><br>
      <div id="demoNoticeDiv"></div>


    <!--   <div id="player"></div> -->
    </div>
    <div class="col-xs-12 col-sm-7  col-md-7  col-lg-7">
      <!-- <label for="select" class="control-label">Text</label> -->
      <div id="textBox"  class="form-control"  contenteditable="true"></div>
    </div>
    <div class="col-xs-12 col-sm-2  col-md-2  col-lg-2">
      <!-- Info -->

 <div class="form-group">
       <a id="installAeneas" class="btn btn-default btn-xs" href="https://github.com/sillsdev/aeneas-installer/releases" target="_blank">Install Aneneas aligner</a>
        <a id="alignBtn" class="btn btn-primary btn-xs" href="#">Align</a>
        <a id="exportSrtBtn" class="btn btn-primary btn-xs" href="#">Export</a>
 </div>
      <div class="checkbox">
        <label>
          <input id="checkboxInput" type="checkbox" > <small>Pause video while typing </small>
        </label>
      </div>
       <label for="inputEmail" class="control-label">Head Tail</label>
       <input type="text" class="form-control" id="inputHeadTail" placeholder="head tail" value="00:00:00,000" disabled>
       <label for="inputEmail" class=" control-label">End Tail</label>
       <input type="text" class="form-control" id="inputEndTail" placeholder="End tail" value="00:00:00,000" disabled>
       <!-- <a id="searchBtn" class="btn btn-default btn-xs" href="#">search</a> -->

<div class="form-group">
  <!-- Espeek languages http://espeak.sourceforge.net/languages.html -->
      <label for="select" class=" control-label">Languages for alignement</label>
        <select class="form-control" id="select" disabled>
          <option value="eng">English</option>
          <option value="it">Italian</option>
          <option value="af">  Afrikaans </option>
          <option value="bs">  Bosnian </option>
          <option value="ca">  Catalan </option>
          <option value="cs">  Czech </option>
          <option value="da">  Danish </option>
          <option value="de">  German </option>
          <option value="el">  Greek </option>
          <option value="eo">  Esperanto </option>
          <option value="es">  Spanish </option>
          <option value="es-la">  Spanish - Latin America </option>
          <option value="fi">  Finnish </option>
          <option value="fr">  French </option>
          <option value="hr">  Croatian </option>
          <option value="hu">  Hungarian </option>
          <option value="lv">  Latvian </option>
          <option value="nl">  Dutch </option>
          <option value="pl">  Polish </option>
          <option value="pt">  Portuguese (Brazil) </option>
          <option value="pt-pt">  Portuguese (European) </option>
          <option value="ro">  Romanian </option>
          <option value="sk">  Slovak </option>
          <option value="sr">  Serbian </option>
          <option value="sv">  Swedish </option>
          <option value="sw">  Swahihi </option>
          <option value="ta">  Tamil </option>
          <option value="tr">  Turkish </option>
          <option value="zh">  Mandarin Chinese </option>
        </select>
    </div>





    </div>
  </div>
</div>

<style>
#textBox{
  width: 100%;
  height: 85vh;
  overflow: scroll;
  background: #fff;
  box-shadow: 0 0 10px #ccc;
  padding: 50px;
}
body{
      background: #f1f1f1;
}
</style>

 <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" ></script>
<!-- ./node_modules/bootstrap/dist/js/bootstrap.min.js -->
</body>
    <!-- All of the Node.js APIs are available in this renderer process. -->
  <script>
    // You can also require other files to run in this process
    if(window.process!=undefined){
      require('./renderer.js')
    }else{
      // run demo code. 
//////////////////////////////////////////////////////////
// demo notice
var demoNotice =`<div class="alert alert-dismissible alert-warning">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
  <h4>Dummy Demo!</h4>
  <p>This is a dummy demo of the app, not all the feature work, and it's for demonstratioon purposes only, it is not a web app. click on <b>load</b> and then <b>align</b> for a demonstration of what the app can do.
  For any questions feel free to get in touch, via <a href="mailto:pietro.passarelli@gmail.com">email</a> or <a href="https://twitter.com/pietropassarell" target="_blank">@pietropassarell</a></p>
</div>`;

document.getElementById('demoNoticeDiv').innerHTML = demoNotice;
      // on click of youtube video load populate video player
      // populate with dummy text
      // Align populate with dummy srt text example
   
var alignBtnEl = document.getElementById('alignBtn');
var exportSrtBtnEl = document.getElementById('exportSrtBtn');
var selectFileBtnEl = document.getElementById('selectFileBtn');
var loadYoutubeUrlBtnEl = document.getElementById('loadYoutubeUrlBtn');
var videoYoutubeUrlInputEl = document.getElementById('videoYoutubeUrlInput');
var videoPreviewEl = document.getElementById('videoPreview');
var textBoxEl = document.getElementById('textBox');
var checkboxInputEl = document.getElementById('checkboxInput');

var isYoutubeVideo = true;
var timeout = null;
var resumeTiypingTimeInterval = 600;
var startStopPlayingVideoOntyping = false;


checkboxInputEl.onclick = function(e){
  // e.preventDefault();
  if(startStopPlayingVideoOntyping == false){
    startStopPlayingVideoOntyping = true;
  }else{
    startStopPlayingVideoOntyping = false;
  }
};


loadYoutubeUrlBtnEl.onclick = function(e){
  e.preventDefault();
  isYoutubeVideo = true;
  // disableTextEditorProgressMessage();
  var url = videoYoutubeUrlInputEl.value;
  //TODO: add validation to check it's a valid youtube URL.
  var youtubeId = youtubeUrlExtractId(url);
  populateYoutubePlayer(youtubeId);

  //TODO: can I use path .join here to add extension to name?
  // var destFileName = dataPath+"/"+ youtubeId+".mp4";
   // sourceVideoPath = destFileName;
  // downloadYoutubeVideo(url, function(destPath){
  //   sourceVideoPath = destPath;
  //   console.log("sourceVideoPath+ ",sourceVideoPath)
  
  //   downloadCaptions(url, function(captionFiles){
  //     if (captionFiles.length ==0){
  //       alert("This video has no captions");
  //     }else{
  //       var captionFile = captionFiles[0];
  //       console.log("1,openYoutubeVttFile");
  //       openYoutubeVttFile(path.join(dataPath,captionFile));
  //       // var captionsContent = openFile(captionFiles[0]);
        
  //       console.log(captionFile);
  //     }
  //   }); 
  // });
};

function youtubeUrlExtractId(url){
  var urlParts = url.split("/");
  var urlPartsLegth = urlParts.length;
  var youtubeId = urlParts[urlPartsLegth-1]
  return youtubeId;
}

function populateYoutubePlayer(id){
  console.log(id);
  //simple implementation 
  var youtubeElement = `<iframe id="youtubeIframe" width='560' height='315' class='embed-responsive-item' src="https://www.youtube.com/embed/${id}" frameborder="0" allowfullscreen></iframe>`;
  // var youtubeElement = `<video width="640" height="360"><source type="video/youtube" src="http://www.youtube.com/watch?v=${id}" /></video>`
  videoPreviewEl.innerHTML = youtubeElement;
  // document.querySelector( 'video' ).addEventListener("playing", checkIfTypingPause, false);
  document.getElementById('youtubeIframe').onload= function() {
    var iframe = document.querySelector('iframe');
    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    //start video 
    //TODO: decide whether to enable this or not. maybe make as an option?
    // innerDoc.querySelectorAll('video')[0].click();
    
    initializeVideoPlayPuaseTypingPreferences();
  };

  loadEditorEith(demoText);
}

function loadEditorEith(content){
    textBoxEl.innerText = content
}


alignBtnEl.onclick = function(){
  loadEditorEith(demoSrtContent)
  makeSrtTimeCodesIntoLinks()
  addLinksToSrtTimecodes()
}


 function makeSrtTimeCodesIntoLinks () {
    // console.log(textBoxEl.innerHTML);
    //http://pietropassarelli.com/regex.html
    textBoxEl.innerHTML = textBoxEl.innerHTML.replace(/(\d{2}[:|.]\d{2}[:|.]\d{2}[.|,|:]\d{3})/ig , function replace(match) { //(?!<)
        return '<a class="timecodeLink">' + match + '</a>'; 
    });
    //TODO: Move curson back to it's possition after replacement editable
    
    //add event listener on class name. 
    //https://stackoverflow.com/questions/19655189/javascript-click-event-listener-on-class
};




function addLinksToSrtTimecodes(){
  var timecodesEl = document.querySelectorAll('.timecodeLink');

  timecodesEl.forEach(function(element, index){
    element.onclick = function(){
      setVideoCurrentTime(element.innerText)
    }
  })
}

function setVideoCurrentTime(timecode){

  //convert timecode
  var time = convertTimeCodeToSeconds(timecode);
  
  if(isYoutubeVideo){
    var iframe = document.querySelector('iframe');
    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    // innerDoc.querySelectorAll('video')[0].click();
    innerDoc.querySelectorAll('video')[0].currentTime = time;
    playVideo();
  }
}

function convertTimeCodeToSeconds(timeString){

  var timeArray = timeString.split(":");

  var hours   = parseFloat(timeArray[0]) * 60 * 60;
  var minutes = parseFloat(timeArray[1]) * 60;
  var seconds = parseFloat(timeArray[2].replace(",","."));
  // var frames  = parseInt(timeArray[3].split(",")[1])*(1/framerate);
  // var str = "h:" + hours + "\nm:" + minutes + "\ns:" + seconds + "\nf:" + frames;
  // console.log(str);
  var totalTime = hours + minutes + seconds// + frames;

  //alert(timeString + " = " + totalTime)
  return totalTime;
}

function playVideo(){
  console.log("play video ");
  // document.querySelector( 'video' ).play();
  if(isYoutubeVideo){
    var iframe = document.querySelector('iframe');
    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;

    if(innerDoc.querySelectorAll('video')[0].src ==""){
      innerDoc.querySelectorAll('video')[0].click();
    }else{
      innerDoc.querySelectorAll('video')[0].play();
    }
    
  }
    
}

function pauseVideo(){
  if(isYoutubeVideo){
    var iframe = document.querySelector('iframe');
    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    // document.querySelector( 'video' ).pause();
    innerDoc.querySelectorAll('video')[0].pause();
  }
  
}


    var demoText =`Have you ever seen the bumper sticker that says the earth does not belong to us? We belong to the earth or maybe you've seen the one that says: save the planet kill yourself. These things are an expression of what we might call liberal environmentalism, and the basic idea behind liberal environmentalism is that mankind is bad for the planet. Now. This way of thinking about the natural world is countered by what we might think of as a kind of conservative environmentalism, although it's not usually called environmentalism where it's not so much that we belong to the earth, but but rather that the earth belongs to us. How does that look to the Orthodox Christian faith? Do we have anything to say about environmentalism? Do we have to pick either liberal environmentalism or conservative stewardship environmentalism? Well, I think we don't have to pick between those two and in fact we actually have a different vision in the Orthodox Church of what man's relationship to the natural world should be. I would say that both we and the earth belong to God. We are both creations of God, and everything is ultimately referred back to go. Man'S purpose is to offer the creation back to God for God's blessing, and then God blesses it and then returns it to man and that blesses men in turn. This is the basic narrative and dynamic of sacrifice on altars, the basic narrative and dynamic of all prayer of liturgical action and so forth, and so, rather than being an alien on the earth which is sort of the liberal environmental vision for mankind on the earth or Being the owner of the earth, which is a more kind of conservative approach to environmentalism, man is rather the priest of this earth. His job is to offer the natural world back up to God for that blessing, and so, if man is the priest, then what does that make the earth? The earth is actually a temple, a church, a cathedral, a cosmic Cathedral, and our purpose in this cosmic cathedral is to worship, God and to use the natural world as part of that worship and this approach to the natural world. This kind of reverence, because we see God as being present in all things - he is not identical with the world, but he is present in the world, the sense that God is present in all things, and so therefore we approach the world with a natural reverence. This idea, this sense, is something that a lot of the saints of the Orthodox Church have had throughout time, such as Saint Seraphim of Sarov and other Saints, who spent a lot of time outdoors and had a real connection with the natural world, seeing it as being Part of God's creation, just as they are part of God's creation, and that we don't belong to the earth. The earth does not belong to us, but we and the earth are the Lord's. You`


//TODO: replace with more accurate srt, with better chunking, once available.
    var demoSrtContent = `1
00:00:07,000 --> 00:00:09,240
Have you ever seen the bumper
sticker that says the earth does

2
00:00:09,240 --> 00:00:10,400
not belong to us?

3
00:00:10,400 --> 00:00:14,350
We belong to the earth or maybe
you've seen the one that says:

4
00:00:14,350 --> 00:00:16,120
save the planet kill yourself.

5
00:00:17,520 --> 00:00:20,960
These things are an expression of
what we might call liberal

6
00:00:20,960 --> 00:00:25,120
environmentalism, and the basic
idea behind liberal

7
00:00:25,120 --> 00:00:29,290
environmentalism is that mankind
is bad for the planet.

8
00:00:29,290 --> 00:00:29,560
Now.

9
00:00:29,560 --> 00:00:32,960
This way of thinking about the
natural world is countered by what

10
00:00:32,960 --> 00:00:36,720
we might think of as a kind of
conservative environmentalism,

11
00:00:36,720 --> 00:00:40,320
although it's not usually called
environmentalism where it's not so

12
00:00:40,320 --> 00:00:43,640
much that we belong to the earth,
but but rather that the earth

13
00:00:43,640 --> 00:00:44,870
belongs to us.

14
00:00:44,870 --> 00:00:47,240
How does that look to the Orthodox
Christian faith?

15
00:00:47,240 --> 00:00:50,400
Do we have anything to say about
environmentalism?

16
00:00:50,400 --> 00:00:54,160
Do we have to pick either liberal
environmentalism or conservative

17
00:00:54,160 --> 00:00:56,320
stewardship environmentalism?

18
00:00:56,320 --> 00:00:59,480
Well, I think we don't have to
pick between those two and in fact

19
00:00:59,480 --> 00:01:03,840
we actually have a different
vision in the Orthodox Church of

20
00:01:03,840 --> 00:01:08,120
what man's relationship to the
natural world should be.

21
00:01:08,120 --> 00:01:14,920
I would say that both we and the
earth belong to God.

22
00:01:14,920 --> 00:01:18,400
We are both creations of God, and
everything is ultimately referred

23
00:01:18,400 --> 00:01:23,360
back to go.

24
00:01:23,360 --> 00:01:28,520
Man'S purpose is to offer the
creation back to God for God's

25
00:01:28,520 --> 00:01:32,600
blessing, and then God blesses it
and then returns it to man and

26
00:01:32,600 --> 00:01:35,120
that blesses men in turn.

27
00:01:35,120 --> 00:01:38,880
This is the basic narrative and
dynamic of sacrifice on altars,

28
00:01:38,880 --> 00:01:42,440
the basic narrative and dynamic of
all prayer of liturgical action

29
00:01:42,440 --> 00:01:47,000
and so forth, and so, rather than
being an alien on the earth which

30
00:01:47,000 --> 00:01:50,680
is sort of the liberal
environmental vision for mankind

31
00:01:50,680 --> 00:01:54,800
on the earth or Being the owner of
the earth, which is a more kind of

32
00:01:54,800 --> 00:01:57,640
conservative approach to
environmentalism, man is rather

33
00:01:57,640 --> 00:02:00,720
the priest of this earth.

34
00:02:00,720 --> 00:02:05,390
His job is to offer the natural
world back up to God for that

35
00:02:05,390 --> 00:02:09,400
blessing, and so, if man is the
priest, then what does that make

36
00:02:09,400 --> 00:02:10,200
the earth?

37
00:02:10,200 --> 00:02:14,880
The earth is actually a temple, a
church, a cathedral, a cosmic

38
00:02:14,880 --> 00:02:19,480
Cathedral, and our purpose in this
cosmic cathedral is to worship,

39
00:02:19,480 --> 00:02:23,280
God and to use the natural world
as part of that worship and this

40
00:02:23,280 --> 00:02:24,440
approach to the natural world.

41
00:02:24,440 --> 00:02:29,040
This kind of reverence, because we
see God as being present in all

42
00:02:29,040 --> 00:02:33,160
things - he is not identical with
the world, but he is present in

43
00:02:33,160 --> 00:02:36,720
the world, the sense that God is
present in all things, and so

44
00:02:36,720 --> 00:02:39,320
therefore we approach the world
with a natural reverence.

45
00:02:39,320 --> 00:02:42,360
This idea, this sense, is
something that a lot of the saints

46
00:02:42,360 --> 00:02:45,240
of the Orthodox Church have had
throughout time, such as Saint

47
00:02:45,240 --> 00:02:48,440
Seraphim of Sarov and other
Saints, who spent a lot of time

48
00:02:48,440 --> 00:02:53,000
outdoors and had a real connection
with the natural world, seeing it

49
00:02:53,000 --> 00:02:55,640
as being Part of God's creation,
just as they are part of God's

50
00:02:55,640 --> 00:03:00,600
creation, and that we don't belong
to the earth.

51
00:03:00,600 --> 00:03:04,920
The earth does not belong to us,
but we and the earth are the

52
00:03:04,920 --> 00:03:06,680
Lord's.

53
00:03:06,680 --> 00:03:07,040
You`
    
    }
    
  </script>
</html>

<!-- <track kind="subtitles" label="English subtitles" src="subtitles_en.vtt" srclang="en" default></track> -->
